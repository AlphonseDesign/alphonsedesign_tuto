{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>{{ video.title }}</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="max-w-4xl mx-auto mt-8 p-4 bg-white rounded-lg shadow-lg">

        <!-- Bouton retour à l'accueil -->
        <div class="mb-4">
            <a href="{% url 'home' %}" class="inline-flex items-center px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-800 rounded shadow">
                <i data-lucide="arrow-left" class="w-5 h-5 mr-2"></i> Retour à l’accueil
            </a>
        </div>

        <h1 class="text-2xl font-bold mb-4">{{ video.title }}</h1>

        <div class="aspect-w-16 aspect-h-9 mb-4">
            <video class="w-full rounded" controls>
                <source src="{{ video.video_file.url }}" type="video/mp4">
                Votre navigateur ne supporte pas la lecture vidéo.
            </video>
        </div>

        <p class="mb-2 text-sm text-gray-500">Vues : {{ video.views }}</p>
        <p class="mb-4">{{ video.description }}</p>

        <div class="flex items-center space-x-4 mb-6">
            {% if user.is_authenticated %}
                <form method="post" action="{% url 'like_video' video.id %}">
                    {% csrf_token %}
                    <button type="submit" class="flex items-center px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded shadow">
                        {% if is_liked %}
                            <i data-lucide="heart" class="w-5 h-5 fill-white mr-2"></i> Retirer Like
                        {% else %}
                            <i data-lucide="heart" class="w-5 h-5 mr-2"></i> Liker
                        {% endif %}
                        ({{ like_count }})
                    </button>
                </form>
            {% endif %}

            <button onclick="copyLink()" class="flex items-center px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded shadow">
                <i data-lucide="share-2" class="w-5 h-5 mr-2"></i> Partager
            </button>
        </div>

        <h2 class="text-xl font-semibold mb-3">Commentaires</h2>

        <div class="space-y-4">
            {% for comment in comments %}
                <div class="bg-gray-100 p-3 rounded">
                    <p class="text-sm text-gray-600 mb-1">
                        <strong>{{ comment.user.username }}</strong> - {{ comment.created_at|date:"d/m/Y H:i" }}
                    </p>
                    <p class="text-gray-800">{{ comment.text }}</p>
                </div>
            {% empty %}
                <p class="text-gray-500">Aucun commentaire pour le moment.</p>
            {% endfor %}
        </div>

        {% if user.is_authenticated %}
            <form method="post" action="{% url 'add_comment' video.id %}" class="mt-6">
                {% csrf_token %}
                <textarea name="content" rows="3" class="w-full p-2 border border-gray-300 rounded mb-2" placeholder="Ajouter un commentaire..."></textarea>
                <button type="submit" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">Publier</button>
            </form>
        {% else %}
            <p class="mt-4 text-sm text-gray-600">
                <a href="{% url 'login' %}" class="text-blue-600 hover:underline">Connecte-toi</a> pour commenter et liker la vidéo.
            </p>
        {% endif %}
    </div>

    <script>
        lucide.createIcons();
        function copyLink() {
            navigator.clipboard.writeText(window.location.href);
            alert("Lien copié dans le presse-papiers !");
        }
    </script>
</body>
</html>
